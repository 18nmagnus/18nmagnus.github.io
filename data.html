<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="UTF-8">
        <title>SciHound - Data</title>
        <link rel="stylesheet" type="text/css" href="./stylesheets/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./stylesheets/normalize.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./stylesheets/data.css" media="screen">
    </head>

    <body>
        

        <script>
            
        </script>

        <header class="page-header">
            <h1 class="project-name">Collected Data</h1>
            <h2 class="project-tagline">A visual library of point data collected by users.</h2>
            <a href="./index.html" class="btn">Return to Home</a>
           <div class="dropdown">
            <button class="dropbtn">Select a Project:</button>
            <div class="dropdown-content">
              <button id="floods">Floods</button>
              <button id="oilpalms">Oil Palms</button>
              <button id="earthquakes">Earthquakes</button>
              <button id="fire">Fire</button>
            </div>
          </div>
        </header>
        
        <h2 id="info" class="main-heading" style="text-align: center;">Select a project above to see collected data.</h2>

        <div class="data-container" id="data">
            <div class="left">
                <h3 id="collector0">Collector:</h3>
                <h4 id="class0">Class:</h4>
                <h4 id="comment0">Comment:</h4>
                <h4 id="photo0">Photo:</h4>
                <h4 id="time0">Timestamp:</h4>
            </div>

            <div class="right">
                <h4 id="heading0">Heading:</h4>
                <h4 id="latitude0">Latitude:</h4>
                <h4 id="longitude0">Longitude:</h4>
                <h4 id="accuracy0">Accuracy:</h4>
            </div>

            <div class="image">
                <img style="background-attachment: fixed; 
                background-position: center;
                position: relative;
                background-repeat: no-repeat;
                height: 100%; width: 100%; object-fit: contain;" id="point_photo0">
            </div>
        </div>

        <div class="data-container" id="data">
            <div class="left">
                <h3 id="collector1">Collector:</h3>
                <h4 id="class1">Class:</h4>
                <h4 id="comment1">Comment:</h4>
                <h4 id="photo1">Photo:</h4>
                <h4 id="time1">Timestamp:</h4>
            </div>

            <div class="right">
                <h4 id="heading1">Heading:</h4>
                <h4 id="latitude1">Latitude:</h4>
                <h4 id="longitude1">Longitude:</h4>
                <h4 id="accuracy1">Accuracy:</h4>
            </div>

            <div class="image">
                <img style="background-attachment: fixed; 
                background-position: center;
                position: relative;
                background-repeat: no-repeat;
                height: 100%; width: 100%; object-fit: contain;" id="point_photo1">
            </div>
        </div>

        <br />
        <button class="next-button" id="next-button">Next</button>

        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-analytics.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-storage.js"></script>

        <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyB-NS4PfFihzVFhZRNXzD0obUZuaBIirso",
            authDomain: "scihound-776c7.firebaseapp.com",
            databaseURL: "https://scihound-776c7.firebaseio.com",
            projectId: "scihound-776c7",
            storageBucket: "scihound-776c7.appspot.com",
            messagingSenderId: "667225946605",
            appId: "1:667225946605:web:bde09af987c1fb64044fe4",
            measurementId: "G-MQSTQVRLKP"
        };
        // Initialize Firebase
        //const firebase = require("firebase");
        // Required for side-effects
        //require("firebase/firestore");
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();

        var db = firebase.firestore();

        var storage = firebase.storage();
        var storageRef = storage.ref();

        document.getElementById("floods").onclick = function () {
            document.getElementById("info").innerHTML = "Data collected for: Floods";

        // Set up reference to point documents in database
        var first = db.collection("Floods")
                .orderBy("timestamp", "desc")
                .limit(2);

        var i = 0;

            return first.get().then(function (documentSnapshots) {
                documentSnapshots.forEach(function (doc) {
                    if(i > 1) {
                        i = 0;
                    }
                    // doc.data() is never undefined for query doc snapshots
                    console.log(doc.id, " => ", doc.data());

                    document.getElementById("collector" + i).innerHTML = "Collector: " + doc.get("collector");
                    document.getElementById("class" + i).innerHTML = "Class: " + doc.get("class");
                    document.getElementById("heading" + i).innerHTML = "Heading: " + doc.get("heading");
                    document.getElementById("latitude" + i).innerHTML = "Latitude: " + doc.get("latitude");
                    document.getElementById("longitude" + i).innerHTML = "Longitude: " + doc.get("longitude");
                    document.getElementById("accuracy" + i).innerHTML = "Accuracy: " + doc.get("accuracy");

                    if(!(doc.get("comment") == "")) {
                        document.getElementById("comment" + i).innerHTML = "Comment: " + doc.get("comment");
                    } else {
                        document.getElementById("comment" + i).innerHTML = "Comment: [none]";
                    }
                    if(!(doc.get("photo") == "")) {
                        document.getElementById("photo" + i).innerHTML = "Photo: " + doc.get("photo");
                        
                        storageRef.child("Images/Floods/" + doc.get("photo")).getDownloadURL().then(function(url) {
                             // 'url' is the download url for Images/Floods/photo.jpg
                             console.log(url);

                             // Insert url into image object
                            var pointImage = document.getElementById("point_photo" + i);
                            pointImage.src = url;
                        }).catch(function(error) {
                            alert("Error loading photos from database." + "\n" + error);
                        });

                    } else {
                        document.getElementById("photo" + i).innerHTML = "Photo: [none]";
                        var img = document.getElementById("point_photo" + i);
                        img.src = "./photos/noimage.png";
                    }
                    document.getElementById("time" + i).innerHTML = "Timestamp: " + doc.get("timestamp");

                    i++;
                });

                // Get the last visible document
                var lastVisible = documentSnapshots.docs[documentSnapshots.docs.length - 1];
                console.log("last", lastVisible);

                // Construct a new query starting at this document,
                // get the next 25 cities.
                var next = db.collection("Floods")
                    .orderBy("timestamp", "desc")
                    .startAfter(lastVisible)
                    .limit(2);
            });
        }

        document.getElementById("oilpalms").onclick = function () {
            document.getElementById("info").innerHTML = "Data collected for: Oil Palms";

            // Set up reference to point documents in database
        var first = db.collection("Oil Palms")
                .orderBy("timestamp", "desc")
                .limit(1);

            return first.get().then(function (documentSnapshots) {
                documentSnapshots.forEach(function (doc) {
                    // doc.data() is never undefined for query doc snapshots
                    console.log(doc.id, " => ", doc.data());

                    document.getElementById("collector").innerHTML = "Collector: " + doc.get("collector");
                    document.getElementById("class").innerHTML = "Class: " + doc.get("class");
                    document.getElementById("heading").innerHTML = "Heading: " + doc.get("heading");
                    document.getElementById("latitude").innerHTML = "Latitude: " + doc.get("latitude");
                    document.getElementById("longitude").innerHTML = "Longitude: " + doc.get("longitude");
                    document.getElementById("accuracy").innerHTML = "Accuracy: " + doc.get("accuracy");

                    if(!(doc.get("comment") == "")) {
                        document.getElementById("comment").innerHTML = "Comment: " + doc.get("comment");
                    } else {
                        document.getElementById("comment").innerHTML = "Comment: [none]";
                    }
                    if(!(doc.get("photo") == "")) {
                        document.getElementById("photo").innerHTML = "Photo: " + doc.get("photo");
                    } else {
                        document.getElementById("photo").innerHTML = "Photo: [none]";
                    }
                    document.getElementById("time").innerHTML = "Timestamp: " + doc.get("timestamp");
                });

                // Get the last visible document
                var lastVisible = documentSnapshots.docs[documentSnapshots.docs.length - 1];
                console.log("last", lastVisible);

                // Construct a new query starting at this document,
                // get the next 25 cities.
                var next = db.collection("Oil Palms")
                    .orderBy("timestamp", "desc")
                    .startAfter(lastVisible)
                    .limit(1);
            });
        }

        document.getElementById("earthquakes").onclick = function () {
            document.getElementById("info").innerHTML = "Data collected for: Earthquakes";

            // Set up reference to point documents in database
        var first = db.collection("Earthquakes")
                .orderBy("timestamp", "desc")
                .limit(1);

            return first.get().then(function (documentSnapshots) {
                documentSnapshots.forEach(function (doc) {
                    // doc.data() is never undefined for query doc snapshots
                    console.log(doc.id, " => ", doc.data());

                    document.getElementById("collector").innerHTML = "Collector: " + doc.get("collector");
                    document.getElementById("class").innerHTML = "Class: " + doc.get("class");
                    document.getElementById("heading").innerHTML = "Heading: " + doc.get("heading");
                    document.getElementById("latitude").innerHTML = "Latitude: " + doc.get("latitude");
                    document.getElementById("longitude").innerHTML = "Longitude: " + doc.get("longitude");
                    document.getElementById("accuracy").innerHTML = "Accuracy: " + doc.get("accuracy");

                    if(!(doc.get("comment") == "")) {
                        document.getElementById("comment").innerHTML = "Comment: " + doc.get("comment");
                    } else {
                        document.getElementById("comment").innerHTML = "Comment: [none]";
                    }
                    if(!(doc.get("photo") == "")) {
                        document.getElementById("photo").innerHTML = "Photo: " + doc.get("photo");
                    } else {
                        document.getElementById("photo").innerHTML = "Photo: [none]";
                    }
                    document.getElementById("time").innerHTML = "Timestamp: " + doc.get("timestamp");
                });

                // Get the last visible document
                var lastVisible = documentSnapshots.docs[documentSnapshots.docs.length - 1];
                console.log("last", lastVisible);

                // Construct a new query starting at this document,
                // get the next 25 cities.
                var next = db.collection("Earthquakes")
                    .orderBy("timestamp", "desc")
                    .startAfter(lastVisible)
                    .limit(1);
            });
        }

        document.getElementById("fire").onclick = function () {
            document.getElementById("info").innerHTML = "Data collected for: Fire";

            // Set up reference to point documents in database
        var first = db.collection("Fire")
                .orderBy("timestamp", "desc")
                .limit(1);

            return first.get().then(function (documentSnapshots) {
                documentSnapshots.forEach(function (doc) {
                    // doc.data() is never undefined for query doc snapshots
                    console.log(doc.id, " => ", doc.data());

                    document.getElementById("collector").innerHTML = "Collector: " + doc.get("collector");
                    document.getElementById("class").innerHTML = "Class: " + doc.get("class");
                    document.getElementById("heading").innerHTML = "Heading: " + doc.get("heading");
                    document.getElementById("latitude").innerHTML = "Latitude: " + doc.get("latitude");
                    document.getElementById("longitude").innerHTML = "Longitude: " + doc.get("longitude");
                    document.getElementById("accuracy").innerHTML = "Accuracy: " + doc.get("accuracy");

                    if(!(doc.get("comment") == "")) {
                        document.getElementById("comment").innerHTML = "Comment: " + doc.get("comment");
                    } else {
                        document.getElementById("comment").innerHTML = "Comment: [none]";
                    }
                    if(!(doc.get("photo") == "")) {
                        document.getElementById("photo").innerHTML = "Photo: " + doc.get("photo");
                    } else {
                        document.getElementById("photo").innerHTML = "Photo: [none]";
                    }
                    document.getElementById("time").innerHTML = "Timestamp: " + doc.get("timestamp");
                });

                // Get the last visible document
                var lastVisible = documentSnapshots.docs[documentSnapshots.docs.length - 1];
                console.log("last", lastVisible);

                // Construct a new query starting at this document,
                // get the next 25 cities.
                var next = db.collection("Fire")
                    .orderBy("timestamp", "desc")
                    .startAfter(lastVisible)
                    .limit(1);
            });
        }
        </script>

    </body>

</html>